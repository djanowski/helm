#!/usr/bin/env ruby

require 'rubygems'
require 'drawer'
require 'helm'

def argv(key)
  start = "--#{key}="
  value = ARGV.detect { |v| v =~ /^#{Regexp.escape(start)}/ }
  value[start.size..-1] if value
end

def append_arguments(args)
  args.each do |k, v|
    ARGV << "--#{k}=#{v}" unless argv(k)
  end
end

Drawer.open('.helm/config') do |config|
  append_arguments(config.cache)
end

Drawer.open('~/.helm_config') do |config|
  append_arguments(config.get(argv(:url)))
end

Helm::Commands.const_get(ARGV.first.capitalize).new(Helm::Session.new).run
